웹 어플리케이션을 공격할 때의 패턴은 **능동적 공격**과 **수동적 공격**이 있음

- **능동적 공격**
    - 공격자가 직접 공격을 가하는 패턴으로 SQL Injection, OS Injection 등이 이에 포함됨
- **수동적 공격**
    - 공격자가 직접 공격하지 않고 사용자가 공격에 대한 트리거를 발생시키는 공격을 의미함
    - 사용자가 스스로 악성 코드를 실행하게 되므로 공격자가 직접 접근하기 힘든 환경인 인트라넷 등에서의 공격도 가능 하고, 브라우저에서의 공격은 서버에 로그를 남기지 않으므로 운영자가 공격을 감지할 수없음
    - 대표적인 수동적 공격
        1. XSS(Cross Site Scripting)
        2. CSRF(Cross Site Request Forgery)
        3. Clickjacking
        4. Open Redirect

## XSS(Cross Site Scripting)

- 웹 애플리케이션의 취약점을 이용해 악성 스크립트를 실행하는 공격
- 페이지의 HTML에 악성 스크립트를 삽입해 사용자가 악성 스크립트를 실행하게 만드는 공격 방법

ex) `https://example.hyundai.com/search?keyword="보안"`이라는 url을 입력 했을 때 아래처럼 HTML에 삽입

```html
<div id="searchKeyword">검색 : 보안 </div>
<div id="searchResult">
  <ul>
  ...
  </ul>
</div>
```

그런데 [`https://example.hyundai.com/search?keyword=](https://example.hyundai.com/search?keyword=)"<img src="">"` 처럼 입력시 취약점을 가짐

⇒ img tag가 XSS 취약점을 가질 수 있고 만약 공격자가 onerror에 공격자의 피싱 사이트 url을 입력하게 되면 나도 모르게 공격을 당할 수 있음

⇒ 과거에는 유튜브나 트위터도 XSS의 취약성이 발견되었다고 함

## XSS(Cross Site Scripting) 공격 패턴

1. **반사형 XSS**
    1. 반사형 XSS는 요청에 포함된 코드를 응답 HTML에 그대로 출력하기 때문에 반사형 XSS라고 함
    2. 요청 내용에 잘못된 스크립트가 포함된 경우에만 발생하며 지속성이 없으므로 비지속성 XSS라고도 함
    3. 잘못된 스크립트가 포함된 요청을 보낸 사용자만 반사형 XSS의 영향을 받음
2. **저장형 XSS**
    1. 공격자가 작성한 악성 스크립트를 포함한 데이터가 서버에 저장되고, 저장된 데이터 내 악성 스크립트가 웹 어플리케이션 페이지에 반영되어 발생하는 패턴
    2. 악성 스크립트를 포함하는 데이터가 서버에 저장되므로 저장형 XSS라고 함
    3. 저장형 XSS는 반사형 XSS와 달리 한번의 공격으로 끝나는것이 아니라 정상적인 요청을 하는 사용자에게도 피해를 줄 수 있어 지속형 XSS라고도 함
    4. 서버에서 악성 스크립트를 제거하지 않으면 지속적인 공격이 가해짐
    5. 3가지 XSS 공격 패턴 중 가장 위험한 패턴
3. **DOM 기반 XSS**
    1. DOM 기반 XSS는 자바스크립트로 DOM을 조작할 때 발생하는 XSS
    2. 서버를 통하지 않으므로 공격을 감지하기 어려움

## XSS(Cross Site Scripting) 방어하기

- 현재 XSS를 방어해주는 라이브러리나 프레임워크가 존재합니다.
- 제대로 사용하기 위해서는 어떠한 대책이 있는지 알아두고 있는 것이 좋음

1. **문자열 이스케이프 처리**
- img tag에서 < img >에서 '<'와 '>' 등을 이스케이프 처리. 아래와 같은 문자들을 이스케이프 처리 할 수 있음

| 특수문자 | 이스케이프 처리 |
| --- | --- |
| & | & |
| < | < |
| > | > |
| " | " |
| ' | ' |
2. **속성값의 문자열을 쌍따옴표로 감싸기**
- 만약 URL이 이러한 형태를 띄고 있다면 이스케이프 처리만으로는 방어하기 힘듦

```
http://example.hyundai/search?keyword="x onmouseover=alert(1)"
```

- 위와 같은 URL이 HTML로 변환되면 아래와 같음

```
<input value="x">
```

- 이렇게 되면 input 속성이 설정되는 결과를 낳아서 의도하지 않은 동작과 공격을 당할 수 있음. 1차적으로는 이러한 속성값을 쌍따옴포(")로 묶어야 함. 그렇게 된다면 위의 코드는 아래처럼 변함

```
<input value="&quot; onmouseover='alert(1)'">
```

3. **링크의 스키마를 http/https로 제한하기**
- tag를 사용할 때에는 http/https 뿐만 아니라 자바스크립트 스키마도 지정할 수 있기 때문에 주의해야 함. 이를 예방하기 위해서는 href 속성 값을 http 또는 https 만으로 제한해서 방어할 수 있음
    
    ```
    <a href="">link</a> // 이러한 스키마 금지!
    ```
    
4. **DOM 조작을 위한 메서드와 프로퍼티 사용하기**
DOM 기반 XSS는 문자열을 HTML로 해석하는 innterHTML 등의 기능을 사용할 때 발생함. 이는 DOM API를 적절하게 사용하는 것으로 방어 할 수 있음
5. **쿠키에 HttpOnly 속성 추가하기**
서버에서 쿠키를 발행할 때 httpOnly 속성을 부여하면 XSS에 의한 쿠키의 유출 위험을 줄일 수 있음. 이는 로그인 서비스 등에서 유용한 방법으로 활용될 수 있음
6. **프레임워크 활용하기**
React, Vue 등의 프레임워크는 내부에서 자동으로 이스케이프 처리를 해줌. React 와 같은 경우는 input 요소에 입력값을 그대로 화면에 반영해도 처리가 자동으로 되기 때문에 XSS 문제가 발생하지 않음
7. **DOMPurify 라이브러리 활용하기**
8. **Sanitizer API 활용하기**
    - DOMPurity와 같이 XSS의 원인이 되는 위험한 문자열을 제거하는 API
    - Sanitizer API는 Sanitizer 클래스를 활용