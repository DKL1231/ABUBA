암호화 기술은 데이터나 정보를 안전하게 보호하기 위해 이를 변환하여 인가된 사람만이 접근할 수 있도록 하는 기술입니다. 암호화는 정보 보안의 중요한 요소로, 특히 민감한 데이터가 네트워크를 통해 전송되거나 저장될 때 불법적인 접근을 방지하는 데 사용됩니다.

## 암호화의 기본 개념
### 평문(Plaintext):

암호화되기 전의 원래 데이터나 메시지를 의미합니다. 평문은 누구나 읽을 수 있는 상태입니다.
### 암호문(Ciphertext):

암호화 과정을 거친 후의 데이터입니다. 평문을 암호화 알고리즘을 통해 변환하여 생성된 결과물로, 원래의 평문을 복원할 수 없도록 보안된 상태입니다.
### 암호화(Encryption):

평문을 암호문으로 변환하는 과정입니다. 암호화는 특정 알고리즘과 키를 사용하여 수행됩니다.
### 복호화(Decryption):

암호문을 다시 평문으로 변환하는 과정입니다. 복호화는 암호화에 사용된 것과 동일한 알고리즘과 키를 사용해야 합니다.
### 키(Key):

암호화와 복호화를 수행하기 위해 사용되는 값입니다. 키의 보안이 암호화의 보안성을 좌우합니다.
## 암호화의 종류
### 대칭키 암호화(Symmetric Key Encryption):

암호화와 복호화에 동일한 키를 사용하는 방식입니다. 대칭키 암호화는 비교적 빠르고 간단하지만, 키를 안전하게 공유하는 것이 어려운 문제입니다.
예시: AES(Advanced Encryption Standard), DES(Data Encryption Standard), 3DES(Triple DES)
### 비대칭키 암호화(Asymmetric Key Encryption):

두 개의 키(공개 키와 비밀 키)를 사용하는 방식입니다. 공개 키로 암호화된 데이터는 비밀 키로만 복호화할 수 있으며, 그 반대도 가능합니다. 비대칭키 암호화는 대칭키 암호화보다 속도가 느리지만, 키 관리와 보안성이 뛰어납니다.
예시: RSA(Rivest-Shamir-Adleman), ECC(Elliptic Curve Cryptography)
### 해시 함수(Hash Function):

입력 데이터를 고정된 크기의 해시 값으로 변환하는 함수입니다. 해시는 암호화와 달리 되돌릴 수 없으며, 주로 데이터 무결성 검증이나 비밀번호 저장 등에 사용됩니다.
예시: SHA-256(Secure Hash Algorithm 256-bit), MD5(Message Digest Algorithm 5)
## 암호화의 활용 분야
### 데이터 전송 보안:

네트워크를 통해 전송되는 데이터는 암호화를 통해 보호됩니다. 예를 들어, HTTPS는 웹 브라우저와 서버 간의 데이터 전송을 SSL/TLS 프로토콜로 암호화하여 보안을 강화합니다.
### 데이터 저장 보안:

데이터베이스나 파일 시스템에 저장된 민감한 데이터는 암호화를 통해 보호됩니다. 이를 통해 데이터가 유출되더라도 내용을 해독할 수 없게 만듭니다.
### 사용자 인증:

암호화는 비밀번호나 인증 토큰과 같은 인증 정보의 안전한 저장과 전송에도 사용됩니다. 해시 함수는 비밀번호를 안전하게 저장하는 데 사용되며, 비대칭키 암호화는 디지털 서명과 인증서에서 사용됩니다.
### 디지털 서명:

비대칭키 암호화를 사용하여 데이터의 출처를 인증하고 무결성을 확인하는 방법입니다. 서명자는 자신의 비밀 키로 데이터를 서명하며, 수신자는 공개 키로 서명을 검증하여 데이터의 신뢰성을 확인할 수 있습니다.
### 암호화의 중요성
암호화는 오늘날의 디지털 환경에서 필수적인 기술입니다. 개인정보, 금융 정보, 기밀 데이터 등의 보호를 위해 암호화 기술은 없어서는 안 될 요소입니다. 특히 인터넷의 발전과 더불어 데이터의 전송과 저장 과정에서의 보안은 더욱 중요해지고 있으며, 강력한 암호화 기술이 이를 뒷받침하고 있습니다.

### 미래의 암호화 기술
양자 컴퓨터의 발전에 따라 현재의 암호화 기술이 취약해질 가능성이 제기되고 있습니다. 이를 대비해 양자내성암호와 같은 새로운 암호화 기술이 연구되고 있으며, 미래의 정보 보안을 위해 적극적으로 개발되고 있습니다.

암호화 기술은 지속적으로 발전하고 있으며, 데이터 보안을 위한 핵심 기술로 그 중요성이 더욱 강조되고 있습니다.

데이터 암호화 여부는 보안 감사에서 필수적으로 언급되는 부분이며, 핀테크 서비스처럼 중요한 정보를 저장하는 서비스에서는 응용 프로그램에서 암호화한 데이터를 데이터 베이스 서버에서 다시 암호화 하는 이중 암호화 방법을 선택하기도 한다.

## MySQL 서버의 데이터 암호화

데이터 베이스 서버와 디스크 사이의 데이터를 읽고 쓰기 지점에서 암호화 또는 복호화를 수행한다.

그래서 디스크 입출력 이외의 부분에서는 암호화 처리가 필요하지 않음. 

더 정확하게는 MySQL 서버(InnoDB 스토리지 엔진)의 I/O 레이어에서만 데이터의 암호화 및 복호화 과정이 실행된다. 

그래서 사용자는 쿼리를 작성하거나 서버에서 쿼리를 처리할 때에 암호화에 대해 전혀 신경을 쓰지 않아도 된다. 이러한 방식을 TDE(Transparent Data Encryption)라고 부른다.

### 2단계 키 관리

서버에서 TDE는 암호화 키는 키링 플러그인에 의해 관리된다.

MySQL서버의 데이터 암호화는 **마스터키**와 테이블 **스페이스키** 두종류의 키를 가지고 있다.

MySQL서버에서는 마스터 키를 키링 플러그인을 통해서 디스크 파일에서 가지고 오거나 HashiCorp Vault같은 외부에서 가지고 온다.

암호화된 테이블을 생성할 때마다 해당 테이블을 위한 임의의 테이블 스페이스 키를 발급한다. 

그러면 이 스페이스 키를 MySQL서버에서 마스터키를 사용해서 테이블 스페이스키를 암호화하고 각 테이블의 데이터 파일 헤더에 저장한다.

이렇게 2단계 키관리를 한다.

보안 상으로는 테이블 스페이스 키를 주기적으로 변경하지 않아도 되지만, 테이블 스페이스 키를 마스터 키로 암호화 하기 때문에 마스터기는 주기적으로 변경해야한다. 이는 `ALTER INSTANCE ROTATE INNODB MASTER KEY;`로 변경한다.

마스터 키를 변경하면 기존 마스터키를 이용해서 테이블 스페이스키를 복호화 하고 새로운 마스터 키로 암호화 한다.

이렇게 2단계로 키를 관리하는 이유는 테이블 스페이스 키로만 암호화를 한다면 보안때문에 스페이스 키를 바꿀 때에 모든 테이블 레코드를 다시 암호화해야해서 부하가 걸리기 때문이다. 

암호화는 AES 256비트 알고리즘으로 한다. 이외의 알고리즘은 지원 X

### 암호화와 성능

암호화를 하면 성능을 떨어트린다. 데이터 페이지가 한번 메모리에 적재되면 동일한 성능이지만 적재까지 복호화, 변경되면 다시 디스크로 동기화 될 때 암호화 하기 때문에 지연이 발생한다.

### 암호화와 복제

MySQL 서버의 복제에서 레플리카 서버는 소스 서버의 모든 사용자 데이터를 동기화 하기 때문에 실제 데이터 파일도 동일할 것이라 생각할 수 있는데 마스터키와 테이블 스페이스 키는 복제되지 않음.

## 테이블 암호화

테이블을 암호화 할때에는 `ENCRYPTION=’Y’`옵션을 추가하면 된다.

테이블이 암호화 된지 보려면 information_schema의 TABLES 뷰를 조회해보면된다. (갓 information_schema)

### 응용 프로그램 암호화와의 비교

응용프로그램에서 암호화를 해서 서버에 저장을 하는 경우에는 인덱스의 활용도가 떨어진다. (내가 1학기때 관통에서 암호화를 한 방식)

그래서 응용프로그램으로 암호화 하지말고 MySQL의 TDE를 사용하도록 하자.

### 테이블 스페이스 이동

테이블을 이동할 때에 암호화가 되지 않은 테이블은 그냥 EXPORT IMPORT하면 끝이다. 하지만 암호화가 되어있다면 `FLUSH TABLE [SOURCE TABLE] FOR EXPORT;` 쿼리를 통해 EXPORT한다. 그러면 테이블의 구조를 .cfg 파일로 데이터를 .ibd파일로 저장하고 이를 `UNLOCK TABLE` 명령어를 통해서 사용하면 된다.